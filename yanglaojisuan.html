<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…»è€æ•™è‚²è´¢åŠ¡è§„åˆ’è®¡ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; touch-action: manipulation; }
        .safe-area { padding-bottom: env(safe-area-inset-bottom); }
        .wx-input { -webkit-appearance: none; appearance: none; }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: 600; }
        .tab-inactive { border-bottom: 3px solid transparent; color: #6b7280; }
        .result-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .number-font { font-family: 'Courier New', monospace; font-weight: bold; }
        
        /* å¾®ä¿¡å…¼å®¹ */
        input, select, button { font-size: 16px; }
        .ios-scroll { -webkit-overflow-scrolling: touch; }
        
        /* é˜²æ­¢å¾®ä¿¡å­—ä½“è°ƒæ•´ */
        body { -webkit-text-size-adjust: 100% !important; }
    </style>
</head>
<body class="bg-gray-50 pb-20">

    <!-- é¡¶éƒ¨ -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 sticky top-0 z-50 shadow-lg">
        <h1 class="text-xl font-bold text-center">ğŸ’° å…»è€æ•™è‚²è´¢åŠ¡è®¡ç®—å™¨</h1>
        <p class="text-xs text-center text-blue-100 mt-1">è€ƒè™‘é€šèƒ€ Â· ç²¾å‡†è§„åˆ’ Â· ç¤¾ä¿ä¼˜åŒ–</p>
    </div>

    <!-- å¯¼èˆª -->
    <div class="flex space-x-4 border-b border-gray-200 bg-white overflow-x-auto px-4 py-2 sticky top-[72px] z-40 shadow-sm ios-scroll">
        <button onclick="switchTab('basic')" id="tab-basic" class="tab-active pb-2 px-2 whitespace-nowrap text-sm">åŸºç¡€</button>
        <button onclick="switchTab('pension')" id="tab-pension" class="tab-inactive pb-2 px-2 whitespace-nowrap text-sm">ç¤¾ä¿</button>
        <button onclick="switchTab('edu')" id="tab-edu" class="tab-inactive pb-2 px-2 whitespace-nowrap text-sm">æ•™è‚²</button>
        <button onclick="switchTab('retire')" id="tab-retire" class="tab-inactive pb-2 px-2 whitespace-nowrap text-sm">å…»è€</button>
        <button onclick="switchTab('result')" id="tab-result" class="tab-inactive pb-2 px-2 whitespace-nowrap text-sm">æŠ¥å‘Š</button>
    </div>

    <div class="p-4 space-y-4 max-w-lg mx-auto">

        <!-- åŸºç¡€ä¿¡æ¯ -->
        <div id="content-basic" class="space-y-4">
            <div class="bg-white rounded-xl shadow p-4">
                <h2 class="font-bold text-gray-800 mb-4 flex items-center text-lg">
                    <span class="bg-blue-100 text-blue-600 p-2 rounded-lg mr-2 text-sm">ğŸ‘¤</span>
                    ä¸ªäººä¿¡æ¯
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å½“å‰å¹´é¾„ <span class="text-blue-600 font-bold" id="val-currentAge">30</span>å²</label>
                        <input type="range" id="currentAge" min="22" max="55" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('currentAge', 'val-currentAge'); calcAll()">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é€€ä¼‘å¹´é¾„ <span class="text-blue-600 font-bold" id="val-retireAge">60</span>å²</label>
                        <input type="range" id="retireAge" min="50" max="70" value="60" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('retireAge', 'val-retireAge'); calcAll()">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é¢„æœŸå¯¿å‘½ <span class="text-blue-600 font-bold" id="val-lifeExp">85</span>å²</label>
                        <input type="range" id="lifeExpectancy" min="70" max="100" value="85" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('lifeExpectancy', 'val-lifeExp'); calcAll()">
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow p-4">
                <h2 class="font-bold text-gray-800 mb-4 flex items-center text-lg">
                    <span class="bg-green-100 text-green-600 p-2 rounded-lg mr-2 text-sm">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span>
                    å®¶åº­çŠ¶å†µ
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å­å¥³æ•°é‡</label>
                        <select id="childCount" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white" onchange="toggleChild(); calcAll()">
                            <option value="0">æ— å­å¥³</option>
                            <option value="1" selected>1ä¸ªå­©å­</option>
                            <option value="2">2ä¸ªå­©å­</option>
                        </select>
                    </div>

                    <div id="child1-box">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å­©å­1å¹´é¾„ <span class="text-green-600 font-bold" id="val-child1">5</span>å²</label>
                        <input type="range" id="childAge1" min="0" max="20" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('childAge1', 'val-child1'); calcAll()">
                    </div>

                    <div id="child2-box" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å­©å­2å¹´é¾„ <span class="text-green-600 font-bold" id="val-child2">3</span>å²</label>
                        <input type="range" id="childAge2" min="0" max="20" value="3" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('childAge2', 'val-child2'); calcAll()">
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow p-4">
                <h2 class="font-bold text-gray-800 mb-4 flex items-center text-lg">
                    <span class="bg-purple-100 text-purple-600 p-2 rounded-lg mr-2 text-sm">ğŸ“Š</span>
                    ç»æµå‡è®¾
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å¹´é€šèƒ€ç‡ <span class="text-purple-600 font-bold" id="val-inflation">3</span>%</label>
                        <input type="range" id="inflation" min="1" max="8" step="0.5" value="3" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('inflation', 'val-inflation'); calcAll()">
                        <p class="text-xs text-gray-500 mt-1">å»ºè®®2-4%ï¼Œè¿‘å¹´CPIå‡å€¼çº¦2-3%</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æŠ•èµ„æ”¶ç›Šç‡ <span class="text-purple-600 font-bold" id="val-return">5</span>%</label>
                        <input type="range" id="investReturn" min="2" max="10" step="0.5" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('investReturn', 'val-return'); calcAll()">
                        <p class="text-xs text-gray-500 mt-1">ä¿å®ˆ3-4%ï¼Œç¨³å¥5-6%ï¼Œæ¿€è¿›7%+</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ç°æœ‰å‚¨è“„ (ä¸‡å…ƒ)</label>
                        <input type="number" id="savings" value="20" step="5" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="calcAll()">
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¤¾ä¿è®¡ç®— -->
        <div id="content-pension" class="space-y-4 hidden">
            <div class="bg-white rounded-xl shadow p-4">
                <h2 class="font-bold text-gray-800 mb-4">ç¤¾ä¿ç¼´çº³ç­–ç•¥</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å½“åœ°å¹³å‡å·¥èµ„ (å…ƒ/æœˆ)</label>
                        <input type="number" id="avgSalary" value="8000" step="500" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcPension()">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ç¼´è´¹æ¡£æ¬¡ <span class="text-red-600 font-bold" id="val-level">100</span>%</label>
                        <input type="range" id="pensionLevel" min="60" max="300" step="10" value="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateSlider('pensionLevel', 'val-level'); calcPension()">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>60%(æœ€ä½)</span>
                            <span>100%</span>
                            <span>300%(æœ€é«˜)</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å·²ç¼´å¹´é™</label>
                            <input type="number" id="paidYears" value="5" min="0" max="40" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcPension()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç»§ç»­ç¼´çº³</label>
                            <input type="number" id="futureYears" value="20" min="0" max="35" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcPension()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-card rounded-xl shadow p-4 text-white">
                <h3 class="font-bold mb-3 text-lg">å…»è€é‡‘é¢„ä¼°ç»“æœ</h3>
                
                <div class="text-center mb-4">
                    <p class="text-sm opacity-90">é€€ä¼‘é¦–æœˆå…»è€é‡‘</p>
                    <p class="text-3xl font-bold number-font">Â¥<span id="res-monthlyPension">0</span></p>
                    <p class="text-xs opacity-75">è€ƒè™‘é€šèƒ€åçš„å®é™…è´­ä¹°åŠ›</p>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                        <p class="text-xs opacity-90">ä¸ªäººè´¦æˆ·</p>
                        <p class="text-lg font-bold number-font">Â¥<span id="res-personal">0</span></p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                        <p class="text-xs opacity-90">åŸºç¡€å…»è€é‡‘</p>
                        <p class="text-lg font-bold number-font">Â¥<span id="res-basic">0</span></p>
                    </div>
                </div>

                <div class="space-y-2 text-sm bg-white bg-opacity-10 rounded-lg p-3">
                    <div class="flex justify-between">
                        <span>æœˆç¼´è´¹é‡‘é¢</span>
                        <span class="font-bold">Â¥<span id="res-monthlyPay">0</span></span>
                    </div>
                    <div class="flex justify-between">
                        <span>æ€»ç¼´è´¹å¹´é™</span>
                        <span class="font-bold"><span id="res-totalYears">0</span>å¹´</span>
                    </div>
                    <div class="flex justify-between">
                        <span>é¢„è®¡å›æœ¬æ—¶é—´</span>
                        <span class="font-bold text-yellow-200"><span id="res-payback">0</span>å¹´</span>
                    </div>
                </div>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                <h3 class="font-bold text-yellow-800 mb-2 text-sm">ğŸ’¡ ä¼˜åŒ–å»ºè®®</h3>
                <div id="pension-tips" class="text-sm text-gray-700 space-y-1">
                    è®¡ç®—ä¸­...
                </div>
            </div>
        </div>

        <!-- æ•™è‚²é‡‘ -->
        <div id="content-edu" class="space-y-4 hidden">
            <div class="bg-white rounded-xl shadow p-4">
                <h2 class="font-bold text-gray-800 mb-4">æ•™è‚²é‡‘è§„åˆ’</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å½“å‰å¹´æ•™è‚²æ”¯å‡º (ä¸‡/å¹´/å­©)</label>
                        <input type="number" id="eduCost" value="3" step="0.5" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcEdu()">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å¤§å­¦å¹´è´¹ç”¨é¢„ä¼° (ä¸‡/å¹´)</label>
                        <input type="number" id="collegeCost" value="4" step="0.5" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcEdu()">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ˜¯å¦ç•™å­¦</label>
                        <select id="studyAbroad" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg bg-white" onchange="toggleAbroad(); calcEdu()">
                            <option value="0">å¦</option>
                            <option value="4">æœ¬ç§‘ç•™å­¦(4å¹´)</option>
                            <option value="2">ç ”ç©¶ç”Ÿç•™å­¦(2å¹´)</option>
                        </select>
                    </div>

                    <div id="abroad-box" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ç•™å­¦å¹´è´¹ç”¨ (ä¸‡/å¹´)</label>
                        <input type="number" id="abroadCost" value="30" step="5" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcEdu()">
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-green-500 to-teal-600 rounded-xl shadow p-4 text-white">
                <h3 class="font-bold mb-3">æ•™è‚²é‡‘æ€»éœ€æ±‚</h3>
                
                <div class="text-center mb-4">
                    <p class="text-sm opacity-90">æ€»ç°å€¼ (å«é€šèƒ€)</p>
                    <p class="text-4xl font-bold number-font">Â¥<span id="res-totalEdu">0</span>ä¸‡</p>
                </div>

                <div id="edu-detail" class="space-y-2 text-sm bg-white bg-opacity-20 rounded-lg p-3 mb-4">
                    <!-- åŠ¨æ€è¯¦æƒ… -->
                </div>

                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm">æ¯æœˆéœ€å®šæŠ•</span>
                        <span class="text-xl font-bold number-font">Â¥<span id="res-eduMonthly">0</span></span>
                    </div>
                    <p class="text-xs opacity-75 mt-1">æŒ‰å¹´åŒ–<span id="res-eduRate">5</span>%æ”¶ç›Šè®¡ç®—</p>
                </div>
            </div>
        </div>

        <!-- å…»è€é‡‘ -->
        <div id="content-retire" class="space-y-4 hidden">
            <div class="bg-white rounded-xl shadow p-4">
                <h2 class="font-bold text-gray-800 mb-4">é€€ä¼‘ç”Ÿæ´»è§„åˆ’</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å½“å‰æœˆç”Ÿæ´»è´¹ (å…ƒ)</label>
                        <input type="number" id="livingCost" value="8000" step="500" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcRetire()">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é€€ä¼‘ç”Ÿæ´»è´¨é‡</label>
                        <select id="retireQuality" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg bg-white" onchange="calcRetire()">
                            <option value="0.7">ç®€æœ´ (å½“å‰70%)</option>
                            <option value="0.8" selected>èˆ’é€‚ (å½“å‰80%)</option>
                            <option value="1.0">ç»´æŒç°çŠ¶ (100%)</option>
                            <option value="1.2">å“è´¨ç”Ÿæ´» (120%)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">åŒ»ç–—å¤‡ç”¨é‡‘ (ä¸‡å…ƒ)</label>
                        <input type="number" id="medical" value="30" step="5" class="wx-input w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="calcRetire()">
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-orange-500 to-red-600 rounded-xl shadow p-4 text-white">
                <h3 class="font-bold mb-3">å…»è€é‡‘ç¼ºå£åˆ†æ</h3>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                        <p class="text-xs opacity-90">æ€»éœ€æ±‚</p>
                        <p class="text-lg font-bold number-font">Â¥<span id="res-totalNeed">0</span>ä¸‡</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                        <p class="text-xs opacity-90">ç¤¾ä¿è¦†ç›–</p>
                        <p class="text-lg font-bold number-font">Â¥<span id="res-pensionCover">0</span>ä¸‡</p>
                    </div>
                </div>

                <div class="text-center mb-4 p-3 bg-white bg-opacity-20 rounded-lg">
                    <p class="text-sm opacity-90">èµ„é‡‘ç¼ºå£</p>
                    <p class="text-3xl font-bold number-font text-yellow-200">Â¥<span id="res-gap">0</span>ä¸‡</p>
                </div>

                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm">æ¯æœˆéœ€é¢å¤–å‚¨è“„</span>
                        <span class="text-xl font-bold number-font">Â¥<span id="res-retireMonthly">0</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»¼åˆæŠ¥å‘Š -->
        <div id="content-result" class="space-y-4 hidden">
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-blue-600 text-white rounded-xl p-4 text-center shadow">
                    <p class="text-xs opacity-90 mb-1">æ€»èµ„é‡‘éœ€æ±‚</p>
                    <p class="text-2xl font-bold number-font">Â¥<span id="sum-total">0</span>ä¸‡</p>
                </div>
                <div class="bg-purple-600 text-white rounded-xl p-4 text-center shadow">
                    <p class="text-xs opacity-90 mb-1">èµ„é‡‘ç¼ºå£</p>
                    <p class="text-2xl font-bold number-font">Â¥<span id="sum-gap">0</span>ä¸‡</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow p-4 text-center">
                <h3 class="font-bold text-gray-800 mb-2">ç›®æ ‡æœˆæ”¶å…¥è¦æ±‚</h3>
                <p class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 number-font mb-1">
                    Â¥<span id="sum-income">0</span>
                </p>
                <p class="text-xs text-gray-500">å®¶åº­æœˆæ€»æ”¶å…¥ï¼ˆç¨å‰ä¼°ç®—ï¼‰</p>
            </div>

            <div class="bg-white rounded-xl shadow p-4">
                <h3 class="font-bold text-gray-800 mb-3">æ”¯å‡ºç»“æ„</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <div class="w-20 text-sm text-gray-600">ç”Ÿæ´»æ”¯å‡º</div>
                        <div class="flex-1 mx-3">
                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div id="bar-living" class="h-full bg-blue-500 transition-all" style="width: 40%"></div>
                            </div>
                        </div>
                        <div class="w-20 text-right text-sm font-bold" id="txt-living">Â¥0</div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-20 text-sm text-gray-600">æ•™è‚²å‚¨è“„</div>
                        <div class="flex-1 mx-3">
                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div id="bar-edu" class="h-full bg-green-500 transition-all" style="width: 30%"></div>
                            </div>
                        </div>
                        <div class="w-20 text-right text-sm font-bold" id="txt-edu">Â¥0</div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-20 text-sm text-gray-600">å…»è€å‚¨è“„</div>
                        <div class="flex-1 mx-3">
                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div id="bar-retire" class="h-full bg-orange-500 transition-all" style="width: 20%"></div>
                            </div>
                        </div>
                        <div class="w-20 text-right text-sm font-bold" id="txt-retire">Â¥0</div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-20 text-sm text-gray-600">ç¤¾ä¿ç¼´è´¹</div>
                        <div class="flex-1 mx-3">
                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div id="bar-social" class="h-full bg-red-500 transition-all" style="width: 10%"></div>
                            </div>
                        </div>
                        <div class="w-20 text-right text-sm font-bold" id="txt-social">Â¥0</div>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-xl p-4">
                <h3 class="font-bold text-indigo-800 mb-2">ğŸ’¡ ç­–ç•¥å»ºè®®</h3>
                <div id="sum-tips" class="text-sm text-gray-700 space-y-2">
                    è®¡ç®—ä¸­...
                </div>
            </div>

            <button onclick="shareResult()" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-transform">
                ğŸ“¤ åˆ†äº«è®¡ç®—ç»“æœ
            </button>
        </div>

    </div>

    <!-- åº•éƒ¨æç¤º -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-3 text-center text-xs text-gray-500 safe-area">
        æ•°æ®ä»…ä¾›å‚è€ƒï¼Œå®é™…è¯·ä»¥ç¤¾ä¿å±€åŠé‡‘èæœºæ„ä¸ºå‡†
    </div>

    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            calcAll();
            
            // å¾®ä¿¡åˆ†äº«é…ç½®ï¼ˆå¦‚æœéƒ¨ç½²åˆ°æœåŠ¡å™¨å¯å¯ç”¨ï¼‰
            if (typeof wx !== 'undefined') {
                wx.ready(function() {
                    wx.updateAppMessageShareData({
                        title: 'å…»è€æ•™è‚²è´¢åŠ¡è§„åˆ’è®¡ç®—å™¨',
                        desc: 'æˆ‘å·²æµ‹ç®—é€€ä¼‘éœ€è¦å‡†å¤‡å¤šå°‘é’±ï¼Œå¿«æ¥è¯•è¯•å§ï¼',
                        link: window.location.href,
                        success: function() {}
                    });
                });
            }
        });

        function switchTab(tab) {
            ['basic', 'pension', 'edu', 'retire', 'result'].forEach(t => {
                document.getElementById('content-' + t).classList.add('hidden');
                document.getElementById('tab-' + t).classList.remove('tab-active');
                document.getElementById('tab-' + t).classList.add('tab-inactive');
            });
            
            document.getElementById('content-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).classList.remove('tab-inactive');
            document.getElementById('tab-' + tab).classList.add('tab-active');
            
            if (tab === 'result') calcSummary();
        }

        function updateSlider(id, valId) {
            document.getElementById(valId).textContent = document.getElementById(id).value;
        }

        function toggleChild() {
            const count = parseInt(document.getElementById('childCount').value);
            document.getElementById('child2-box').classList.toggle('hidden', count < 2);
        }

        function toggleAbroad() {
            const val = document.getElementById('studyAbroad').value;
            document.getElementById('abroad-box').classList.toggle('hidden', val === '0');
        }

        function calcAll() {
            calcPension();
            calcEdu();
            calcRetire();
        }

        // ç¤¾ä¿è®¡ç®—
        function calcPension() {
            const avg = parseFloat(document.getElementById('avgSalary').value) || 8000;
            const level = parseInt(document.getElementById('pensionLevel').value) / 100;
            const paid = parseInt(document.getElementById('paidYears').value) || 0;
            const future = parseInt(document.getElementById('futureYears').value) || 0;
            const retireAge = parseInt(document.getElementById('retireAge').value);
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const inflation = parseFloat(document.getElementById('inflation').value) / 100;
            
            const totalYears = paid + future;
            const base = avg * level;
            const monthlyPay = base * 0.28;
            const personal = base * 0.08;
            
            // ä¸ªäººè´¦æˆ·ç§¯ç´¯ï¼ˆç®€åŒ–è®¡ç®—ï¼Œå«æ”¶ç›Šï¼‰
            let balance = personal * 12 * paid;
            for (let i = 0; i < future; i++) {
                balance = balance * 1.035 + personal * 12;
            }
            
            const months = Math.max(139, (retireAge - 60) * 12 + 139);
            const personalPension = balance / months;
            const basicPension = avg * (1 + level) / 2 * totalYears * 0.01;
            const total = personalPension + basicPension;
            const realPension = total / Math.pow(1 + inflation, retireAge - currentAge);
            
            document.getElementById('res-monthlyPension').textContent = Math.round(realPension).toLocaleString();
            document.getElementById('res-personal').textContent = Math.round(personalPension).toLocaleString();
            document.getElementById('res-basic').textContent = Math.round(basicPension).toLocaleString();
            document.getElementById('res-monthlyPay').textContent = Math.round(monthlyPay).toLocaleString();
            document.getElementById('res-totalYears').textContent = totalYears;
            
            const totalPaid = monthlyPay * 12 * totalYears;
            document.getElementById('res-payback').textContent = (totalPaid / total / 12).toFixed(1);
            
            // å»ºè®®
            let tips = '';
            if (totalYears < 15) {
                tips = '<p class="text-red-600 font-bold">âš ï¸ ç¼´è´¹ä¸è¶³15å¹´ï¼Œé€€ä¼‘åå°†æ— æ³•é¢†å–å…»è€é‡‘ï¼</p>';
            } else if (level < 0.8) {
                tips = '<p>â€¢ å½“å‰æ¡£æ¬¡è¾ƒä½ï¼Œå»ºè®®æé«˜è‡³100%ä»¥ä¸Š</p><p>â€¢ ç¼´è´¹å¹´é™æ¯”æ¡£æ¬¡æ›´é‡è¦ï¼Œå»ºè®®æŒç»­ç¼´çº³</p>';
            } else if (level > 2) {
                tips = '<p>â€¢ é«˜æ¡£æ¬¡ç¼´è´¹ï¼Œä¸ªäººè´¦æˆ·ç§¯ç´¯ä¸°åš</p><p>â€¢ è¶…è¿‡300%éƒ¨åˆ†å»ºè®®é€šè¿‡å•†ä¸šä¿é™©è¡¥å……</p>';
            } else {
                tips = '<p>â€¢ ç¼´è´¹ç­–ç•¥é€‚ä¸­ï¼Œå»ºè®®ä¿æŒè¿ç»­æ€§</p><p>â€¢ é€€ä¼‘å‰5å¹´å¯æé«˜ç¼´è´¹æ¡£æ¬¡</p>';
            }
            document.getElementById('pension-tips').innerHTML = tips;
        }

        // æ•™è‚²é‡‘è®¡ç®—
        function calcEdu() {
            const count = parseInt(document.getElementById('childCount').value);
            const age1 = parseInt(document.getElementById('childAge1').value);
            const age2 = parseInt(document.getElementById('childAge2').value);
            const cost = parseFloat(document.getElementById('eduCost').value) || 3;
            const college = parseFloat(document.getElementById('collegeCost').value) || 4;
            const inflation = parseFloat(document.getElementById('inflation').value) / 100;
            const ret = parseFloat(document.getElementById('investReturn').value) / 100;
            const abroad = parseInt(document.getElementById('studyAbroad').value);
            const abroadCost = parseFloat(document.getElementById('abroadCost').value) || 30;
            
            function calcChild(age) {
                let total = 0;
                const toCollege = 18 - age;
                const toGrad = 22 - age;
                
                // K-12
                for (let i = 0; i < toCollege; i++) {
                    total += cost * Math.pow(1 + inflation, i);
                }
                // å¤§å­¦
                for (let i = toCollege; i < toGrad; i++) {
                    let c = college * Math.pow(1 + inflation, i);
                    if (abroad === 4 && i < toCollege + 4) c = abroadCost * Math.pow(1 + inflation, i);
                    if (abroad === 2 && i >= toCollege + 2) c = abroadCost * Math.pow(1 + inflation, i);
                    total += c;
                }
                return { total, years: toGrad };
            }
            
            const c1 = calcChild(age1);
            let total = c1.total;
            let detail = `<p>å­©å­1 (å½“å‰${age1}å²): <span class="font-bold">${c1.total.toFixed(1)}ä¸‡</span></p>`;
            
            if (count >= 2) {
                const c2 = calcChild(age2);
                total += c2.total;
                detail += `<p>å­©å­2 (å½“å‰${age2}å²): <span class="font-bold">${c2.total.toFixed(1)}ä¸‡</span></p>`;
            }
            
            const maxYears = Math.max(c1.years, count >= 2 ? (22 - age2) : 0);
            const monthly = pmt(ret/12, maxYears*12, 0, total*10000) / 10000;
            
            document.getElementById('res-totalEdu').textContent = total.toFixed(1);
            document.getElementById('edu-detail').innerHTML = detail;
            document.getElementById('res-eduMonthly').textContent = Math.round(monthly * 10000).toLocaleString();
            document.getElementById('res-eduRate').textContent = (ret * 100).toFixed(1);
        }

        // å…»è€é‡‘è®¡ç®—
        function calcRetire() {
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const retireAge = parseInt(document.getElementById('retireAge').value);
            const life = parseInt(document.getElementById('lifeExpectancy').value);
            const living = parseFloat(document.getElementById('livingCost').value) || 8000;
            const quality = parseFloat(document.getElementById('retireQuality').value);
            const medical = parseFloat(document.getElementById('medical').value) || 30;
            const inflation = parseFloat(document.getElementById('inflation').value) / 100;
            const ret = parseFloat(document.getElementById('investReturn').value) / 100;
            const pension = parseFloat(document.getElementById('res-monthlyPension').textContent.replace(/,/g, '')) || 0;
            
            const yearsToRetire = retireAge - currentAge;
            const retireYears = life - retireAge;
            
            const futureLiving = living * quality * Math.pow(1 + inflation, yearsToRetire);
            const livingNeed = futureLiving * 12 * retireYears * Math.pow(1 + inflation, retireYears/2) / 10000;
            const totalNeed = livingNeed + medical;
            const pensionCover = pension * 12 * retireYears / 10000;
            const gap = Math.max(0, totalNeed - pensionCover);
            
            const monthlySave = pmt(ret/12, yearsToRetire*12, 0, gap*10000) / 10000;
            
            document.getElementById('res-totalNeed').textContent = totalNeed.toFixed(1);
            document.getElementById('res-pensionCover').textContent = pensionCover.toFixed(1);
            document.getElementById('res-gap').textContent = gap.toFixed(1);
            document.getElementById('res-retireMonthly').textContent = Math.round(monthlySave * 10000).toLocaleString();
        }

        // ç»¼åˆæŠ¥å‘Š
        function calcSummary() {
            const edu = parseFloat(document.getElementById('res-totalEdu').textContent) || 0;
            const retireNeed = parseFloat(document.getElementById('res-totalNeed').textContent) || 0;
            const pensionCover = parseFloat(document.getElementById('res-pensionCover').textContent) || 0;
            const savings = parseFloat(document.getElementById('savings').value) || 0;
            const gap = Math.max(0, edu + retireNeed - savings - pensionCover);
            
            const living = parseFloat(document.getElementById('livingCost').value) || 8000;
            const eduMonthly = parseFloat(document.getElementById('res-eduMonthly').textContent.replace(/,/g, '')) || 0;
            const retireMonthly = parseFloat(document.getElementById('res-retireMonthly').textContent.replace(/,/g, '')) || 0;
            const socialMonthly = parseFloat(document.getElementById('res-monthlyPay').textContent.replace(/,/g, '')) || 0;
            
            const total = living + eduMonthly + retireMonthly + socialMonthly;
            const income = total * 1.3; // è€ƒè™‘ç¨è´¹
            
            document.getElementById('sum-total').textContent = (edu + retireNeed).toFixed(1);
            document.getElementById('sum-gap').textContent = gap.toFixed(1);
            document.getElementById('sum-income').textContent = Math.round(income).toLocaleString();
            
            // è¿›åº¦æ¡
            const maxVal = Math.max(living, eduMonthly, retireMonthly, socialMonthly);
            document.getElementById('bar-living').style.width = (living/maxVal*100) + '%';
            document.getElementById('bar-edu').style.width = (eduMonthly/maxVal*100) + '%';
            document.getElementById('bar-retire').style.width = (retireMonthly/maxVal*100) + '%';
            document.getElementById('bar-social').style.width = (socialMonthly/maxVal*100) + '%';
            
            document.getElementById('txt-living').textContent = 'Â¥' + Math.round(living).toLocaleString();
            document.getElementById('txt-edu').textContent = 'Â¥' + Math.round(eduMonthly).toLocaleString();
            document.getElementById('txt-retire').textContent = 'Â¥' + Math.round(retireMonthly).toLocaleString();
            document.getElementById('txt-social').textContent = 'Â¥' + Math.round(socialMonthly).toLocaleString();
            
            // å»ºè®®
            const years = parseInt(document.getElementById('retireAge').value) - parseInt(document.getElementById('currentAge').value);
            let tips = '';
            if (gap <= 0) {
                tips = '<p class="text-green-600 font-bold">ğŸ‰ è´¢åŠ¡çŠ¶å†µè‰¯å¥½ï¼å»ºè®®ä¿æŒå½“å‰å‚¨è“„ç‡ï¼Œå¯è€ƒè™‘å¢åŠ ä¿é™©ä¿éšœã€‚</p>';
            } else if (years > 20) {
                tips = `<p>â€¢ æ‚¨æœ‰${years}å¹´å‡†å¤‡æœŸï¼Œå»ºè®®é‡‡ç”¨"å®šæŠ•+å¤åˆ©"ç­–ç•¥</p>
                       <p>â€¢ æ¯æœˆå®šæŠ•${Math.round(eduMonthly + retireMonthly)}å…ƒè‡³æŒ‡æ•°åŸºé‡‘</p>
                       <p>â€¢ ç¤¾ä¿ç»´æŒ100%-150%æ¡£æ¬¡ï¼Œç¡®ä¿åŸºç¡€ä¿éšœ</p>`;
            } else {
                tips = `<p class="text-orange-600 font-bold">âš¡ å‡†å¤‡æ—¶é—´ç´§å¼ (${years}å¹´)ï¼</p>
                       <p>â€¢ ç«‹å³æé«˜å‚¨è“„ç‡è‡³30%ä»¥ä¸Š</p>
                       <p>â€¢ è€ƒè™‘å»¶é•¿å·¥ä½œå¹´é™æˆ–å¢åŠ å‰¯ä¸šæ”¶å…¥</p>
                       <p>â€¢ ç¤¾ä¿æé«˜è‡³æœ€é«˜æ¡£(300%)</p>`;
            }
            document.getElementById('sum-tips').innerHTML = tips;
        }

        // åˆ†äº«åŠŸèƒ½
        function shareResult() {
            const text = `ã€å…»è€æ•™è‚²è´¢åŠ¡è§„åˆ’ã€‘\n` +
                        `æ€»èµ„é‡‘éœ€æ±‚ï¼šÂ¥${document.getElementById('sum-total').textContent}ä¸‡\n` +
                        `èµ„é‡‘ç¼ºå£ï¼šÂ¥${document.getElementById('sum-gap').textContent}ä¸‡\n` +
                        `å»ºè®®æœˆæ”¶å…¥ï¼šÂ¥${document.getElementById('sum-income').textContent}\n\n` +
                        `å¿«æ¥æµ‹ç®—ä½ çš„é€€ä¼‘è§„åˆ’å§ï¼`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'å…»è€æ•™è‚²è´¢åŠ¡è§„åˆ’',
                    text: text,
                    url: window.location.href
                }).catch(err => console.log('åˆ†äº«å¤±è´¥', err));
            } else {
                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                const input = document.createElement('textarea');
                input.value = text;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¿«å»åˆ†äº«ç»™æœ‹å‹å§ï¼');
            }
        }

        // è´¢åŠ¡å‡½æ•°
        function pmt(rate, nper, pv, fv) {
            if (rate === 0) return -(pv + fv) / nper;
            const pvif = Math.pow(1 + rate, nper);
            return -rate * (pv * pvif + fv) / (pvif - 1);
        }
    </script>
</body>
</html>